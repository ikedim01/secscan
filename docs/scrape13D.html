---

title: scrape13D


keywords: fastai
sidebar: home_sidebar

summary: "Scrape holdings information from 13D SEC filings."
description: "Scrape holdings information from 13D SEC filings."
nb_path: "11_scrape13D.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 11_scrape13D.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>13D scraper class - scrape holdings information from the SEC filing:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="scraper13D" class="doc_header"><code>class</code> <code>scraper13D</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/scrape13D.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>scraper13D</code>(<strong><code>infoDir</code></strong>=<em><code>'C:\\Users\\ikedi\\secData\\scraped13D'</code></em>, <strong><code>startD</code></strong>=<em><code>None</code></em>, <strong><code>endD</code></strong>=<em><code>None</code></em>, <strong><code>fSuff</code></strong>=<em><code>'m.pkl'</code></em>) :: <a href="/secscan/scrape13G.html#scraper13G"><code>scraper13G</code></a></p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test 13D scraper class:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dl</span> <span class="o">=</span> <span class="n">dailyList</span><span class="o">.</span><span class="n">dailyList</span><span class="p">(</span><span class="n">startD</span><span class="o">=</span><span class="s1">&#39;empty&#39;</span><span class="p">)</span>
<span class="n">dl</span><span class="o">.</span><span class="n">updateForDays</span><span class="p">(</span><span class="s1">&#39;20210701&#39;</span><span class="p">,</span><span class="s1">&#39;20210704&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">getFilingsList</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;SC 13D&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="mi">84</span><span class="p">,</span><span class="s2">&quot;testing 13D scraper class (daily list count)&quot;</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scrape13G</span><span class="o">.</span><span class="n">parse13GD</span><span class="p">(</span><span class="s1">&#39;0000921895-21-001173&#39;</span><span class="p">,</span> <span class="n">formType</span><span class="o">=</span><span class="s1">&#39;SC 13D/A&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;ciks&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s1">&#39;0001165002&#39;</span><span class="p">,</span> <span class="s1">&#39;0001461945&#39;</span><span class="p">]</span>
        <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;positions&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[(</span><span class="s1">&#39;412,925&#39;</span><span class="p">,</span> <span class="s1">&#39;5.0&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;430,214&#39;</span><span class="p">,</span> <span class="s1">&#39;5.2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;843,139&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="s1">&#39;843,139&#39;</span><span class="p">,</span> <span class="s1">&#39;10.2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;860,416&#39;</span><span class="p">,</span> <span class="s1">&#39;10.4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;860,416&#39;</span><span class="p">,</span> <span class="s1">&#39;10.4&#39;</span><span class="p">)]</span>
        <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Item 4 is hereby amended and restated to read&#39;</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;management, Board a&#39;</span><span class="p">)</span>
    <span class="p">),</span><span class="s2">&quot;testing 13D scraper class (parsing)&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>WEEKEND20210703 UPDATE20210702 ### list index 64 count for 20210702: 6569 * UPDATE20210701 count for 20210701: 5573 * </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Combine 13F, 13G, and 13D filings for a quarter:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get13GDDatesForQ" class="doc_header"><code>get13GDDatesForQ</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/scrape13D.py#L27" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get13GDDatesForQ</code>(<strong><code>y</code></strong>, <strong><code>qNo</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getCombNSSForQ" class="doc_header"><code>getCombNSSForQ</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/scrape13D.py#L40" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getCombNSSForQ</code>(<strong><code>y</code></strong>, <strong><code>qNo</code></strong>, <strong><code>cusipNameFilter</code></strong>=<em><code>&lt;lambda&gt;</code></em>, <strong><code>include13F</code></strong>=<em><code>True</code></em>, <strong><code>include13G</code></strong>=<em><code>False</code></em>, <strong><code>include13D</code></strong>=<em><code>False</code></em>, <strong><code>outsInfoFName</code></strong>=<em><code>''</code></em>, <strong><code>outDir</code></strong>=<em><code>'ratings'</code></em>, <strong><code>minAUM</code></strong>=<em><code>None</code></em>, <strong><code>minTopNFrac</code></strong>=<em><code>None</code></em>, <strong><code>minTopN</code></strong>=<em><code>10</code></em>, <strong><code>max13FCount</code></strong>=<em><code>None</code></em>, <strong><code>minFrac</code></strong>=<em><code>0.0</code></em>, <strong><code>maxFrac</code></strong>=<em><code>1.0</code></em>, <strong><code>minAllInvsPerStock</code></strong>=<em><code>None</code></em>, <strong><code>maxAllInvsPerStock</code></strong>=<em><code>None</code></em>, <strong><code>minMatStocksPerInv</code></strong>=<em><code>None</code></em>, <strong><code>maxMatStocksPerInv</code></strong>=<em><code>None</code></em>, <strong><code>minMatInvsPerStock</code></strong>=<em><code>None</code></em>, <strong><code>maxMatInvsPerStock</code></strong>=<em><code>None</code></em>, <strong><code>cusipFilter</code></strong>=<em><code>None</code></em>, <strong><code>dtype</code></strong>=<em><code>float64</code></em>, <strong><code>max13GDBonus</code></strong>=<em><code>0.2</code></em>, <strong><code>min13GDBonus</code></strong>=<em><code>0.02</code></em>, <strong><code>max13GDCount</code></strong>=<em><code>100</code></em>)</p>
</blockquote>

<pre><code>Calculates a matrix of investor holdings for a quarter, based on all 13F filings filed
during the succeeding quarter, combined with 13G and 13D filings from the previous two
years through the succeeding quarter.

Returns mat, ciks, cusips where mat is a matrix of shape (len(ciks), len(cusips))
in which each row has the fractions held by the corresponding cik in each cusip.

If cusipNameFilter is specified, this should be a function that gets two arguments (cusip and
name, where name will be None if no name was found in either the SEC 13F CUSIP name index or
in the CUSIP-CIK correspondence from 13D and 13G forms), and returns True for cusips to keep.

Uses scrape13F.filter13FHoldings and scrape13F.holdingsMapToMatrix to filter the returned matrix.
Uses scrape13G.calcBonusMap to calculate rating bonuses for 13G/D positions.

</code></pre>
<hr>
<p>filter13FHoldings arguments: minAUM=None, minTopNFrac=None, minTopN=10, max13FCount=None, minFrac=0.0, maxFrac=1.0</p>

<pre><code>Filters a condensed list of 13F stock holdings as returned from condense13FHoldings,
i.e. a list of tuples:
    [(cusip, val, frac) ... ]
sorted in descending order by value.

If minTopNFrac is specified, returns None for lists with too small a total fraction
in the top minTopN stocks.
If minAUM is specified, returns None for lists with too small a total value.
If max13FCount is specified, returns None for lists with too many stocks.

Restricts the returned list to stocks with fraction of total value in [minFrac..maxFrac]

</code></pre>
<hr>
<p>holdingsMapToMatrix arguments: minAllInvsPerStock=None, maxAllInvsPerStock=None, minMatStocksPerInv=None, maxMatStocksPerInv=None, minMatInvsPerStock=None, maxMatInvsPerStock=None, cusipFilter=None, dtype=&lt;class 'numpy.float64'&gt;</p>

<pre><code>Converts a holdings map: cik -&gt; {cusip -&gt; frac} into a matrix.

Returns mat, ciks, cusips where mat is a matrix of shape (len(ciks), len(cusips))
in which each row has the fractions held by the corresponding cik in each cusip.

If minAllInvsPerStock or maxAllInvsPerStock is specified, then allCusipCounter should be a
Counter giving a count of all investors that have any position in each stock, and the result
will be filtered based on this count. Otherwise allCusipCounter can be None.

If minMatStocksPerInv is specified, restricts to investors with at least that many stocks
in the returned matrix; likewise, maxMatStocksPerInv can be used to give an upper bound.

If minMatInvsPerStock is specified, restricts to stocks with at least that many investors
in the returned matrix; likewise, maxMatInvsPerStock can be used to give an upper bound.

If cusipFilter is specified, this should be a function that returns True for cusips to keep.

dtype specifies the type of the returned matrix.

</code></pre>
<hr>
<p>calcBonusMap arguments: max13GDBonus=0.2, min13GDBonus=0.02, max13GDCount=100</p>

<pre><code>Calculate "bonus fractions" for cusips where a 13G or 13D has been filed.

allCusipCounter should be a Counter, and it will be updated to count all investors that
have any position in each stock.

13GD bonus fractions are 1.0/#positions, but restricted to [min13GDBonus..max13GDBonus]
If max13GDCount is not None, restricts to investors with at most max13GDCount combined 13G
and 13D positions. For positions between [1.0% .. 5.0%), the bonus is cut in half;
positions below 1.0% aren't given a bonus.

Returns a dict: cik -&gt; {cusip -&gt; bonusfrac}</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="oddballScreen" class="doc_header"><code>oddballScreen</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/scrape13D.py#L118" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>oddballScreen</code>(<strong><code>yNo</code></strong>, <strong><code>qNo</code></strong>)</p>
</blockquote>
<p>Screens for stocks that only one investor reports holding.
These will mostly be mistakes, so I try to remove the mistakes using cusipFilter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

