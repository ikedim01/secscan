---

title: dailyList


keywords: fastai
sidebar: home_sidebar

summary: "Parse the SEC's archived daily list of filings."
description: "Parse the SEC's archived daily list of filings."
nb_path: "02_dailyList.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 02_dailyList.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Download and parse the SEC's archived daily list of filings:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getQStr" class="doc_header"><code>getQStr</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/dailyList.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getQStr</code>(<strong><code>dateStr</code></strong>)</p>
</blockquote>
<p>Converts a date in YYYYMMDD format to YYYY/QTRn/
where n is the quarter number from 1 to 4."</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getSecDailyIndexUrl" class="doc_header"><code>getSecDailyIndexUrl</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/dailyList.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getSecDailyIndexUrl</code>(<strong><code>dateStr</code></strong>, <strong><code>listType</code></strong>=<em><code>'master'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="getDailyFList" class="doc_header"><code>getDailyFList</code><a href="https://github.com/ikedim01/secscan/tree/master/secscan/dailyList.py#L32" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>getDailyFList</code>(<strong><code>d</code></strong>)</p>
</blockquote>
<p>Returns a list of SEC filed forms:
    [(cik, cikName, formType, fileDate, accNo), ... ]
for the given date or ISO date string, retrieved from
the SEC daily index.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test downloading and parsing SEC's archived daily list of filings:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="p">((</span><span class="n">getQStr</span><span class="p">(</span><span class="s1">&#39;20200101&#39;</span><span class="p">),</span><span class="n">getQStr</span><span class="p">(</span><span class="s1">&#39;20200401&#39;</span><span class="p">),</span><span class="n">getQStr</span><span class="p">(</span><span class="s1">&#39;20201201&#39;</span><span class="p">))</span>
        <span class="o">==</span> <span class="p">(</span><span class="s1">&#39;2020/QTR1/&#39;</span><span class="p">,</span><span class="s1">&#39;2020/QTR2/&#39;</span><span class="p">,</span><span class="s1">&#39;2020/QTR4/&#39;</span><span class="p">)),</span> <span class="s2">&quot;Quarter string calc&quot;</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">getSecDailyIndexUrl</span><span class="p">(</span><span class="s1">&#39;20201201&#39;</span><span class="p">)</span>
        <span class="o">==</span><span class="s1">&#39;/Archives/edgar/daily-index/2020/QTR4/master.20201201.idx&#39;</span><span class="p">),</span> <span class="s2">&quot;Daily index URL&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">getDailyFList</span><span class="p">(</span><span class="s1">&#39;20201201&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">==</span><span class="mi">3464</span> <span class="ow">and</span> <span class="n">r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span> <span class="p">(</span><span class="s1">&#39;97745&#39;</span><span class="p">,</span> <span class="s1">&#39;THERMO FISHER SCIENTIFIC INC.&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;8-K&#39;</span><span class="p">,</span> <span class="s1">&#39;20201201&#39;</span><span class="p">,</span> <span class="s1">&#39;0000097745-20-000055&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>*** Problem downloading https://www.sec.gov/Archives/edgar/daily-index/2020/QTR4/master.20201201.idx - 403 Client Error: Forbidden for url: https://www.sec.gov/Archives/edgar/daily-index/2020/QTR4/master.20201201.idx ; retrying ...
filings for 20201201: 3464 </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Update a trio of dicts</p>

<pre><code>    dlMap: dateStr -&gt; list of filings [(cik, formType, accNo, fDate,'*'), ... ]
    cikNameMap: cik -&gt; (name, latestDateStr)
    cikOldNamesMap: cik -&gt; [name1, name2, ...]</code></pre>
<p>using the SEC's archived daily list of filings:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">findCikName</span><span class="p">(</span><span class="n">cikName</span><span class="p">,</span><span class="n">oldNames</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks if a CIK name already appears in a list of old names (case insensitive).</span>
<span class="sd">    Returns the position if it appears, else -1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cikName</span> <span class="o">=</span> <span class="n">cikName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">oldName</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">oldNames</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="n">cikName</span> <span class="o">==</span> <span class="n">oldName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

<span class="k">def</span> <span class="nf">updateCikNameMapsFromEntry</span><span class="p">(</span><span class="n">dStr</span><span class="p">,</span> <span class="n">cik</span><span class="p">,</span> <span class="n">cikName</span><span class="p">,</span> <span class="n">cikNameMap</span><span class="p">,</span> <span class="n">cikOldNamesMap</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates two maps:</span>
<span class="sd">        cikNameMap: cik -&gt; (name, latestDateStr)</span>
<span class="sd">        cikOldNamesMap: cik -&gt; [oldname1, oldname2, ...]</span>
<span class="sd">    to reflect an entry (cik, cikName, ... ) from the index for day dStr.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">cik</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cikNameMap</span> <span class="p">:</span> <span class="c1"># completely new name</span>
        <span class="n">cikNameMap</span><span class="p">[</span><span class="n">cik</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cikName</span><span class="p">,</span> <span class="n">dStr</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">mapName</span><span class="p">,</span> <span class="n">mapDStr</span> <span class="o">=</span> <span class="n">cikNameMap</span><span class="p">[</span><span class="n">cik</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dStr</span> <span class="o">&lt;</span> <span class="n">mapDStr</span> <span class="p">:</span>
        <span class="c1"># name in cikNameMap is newer than this entry</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="n">cikName</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="c1"># this entry is newer than the name in cikNameMap - update the map</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="n">mapName</span>
        <span class="n">cikNameMap</span><span class="p">[</span><span class="n">cik</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">cikName</span><span class="p">,</span> <span class="n">dStr</span><span class="p">)</span>
        <span class="n">mapName</span> <span class="o">=</span> <span class="n">cikName</span>
    <span class="k">if</span> <span class="n">oldName</span><span class="o">==</span><span class="n">mapName</span> <span class="ow">or</span> <span class="n">oldName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="n">curName</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">:</span>
        <span class="c1"># old and new names are the same</span>
        <span class="k">return</span>
    <span class="c1"># update the old names map:</span>
    <span class="k">if</span> <span class="n">cik</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cikOldNamesMap</span> <span class="p">:</span>
        <span class="n">cikOldNamesMap</span><span class="p">[</span><span class="n">cik</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldName</span><span class="p">]</span>
        <span class="k">return</span>
    <span class="n">oldNames</span> <span class="o">=</span> <span class="n">cikOldNamesMap</span><span class="p">[</span><span class="n">cik</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">findCikName</span><span class="p">(</span><span class="n">oldName</span><span class="p">,</span> <span class="n">oldNames</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">:</span> <span class="c1"># add a new old name</span>
        <span class="n">oldNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oldName</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">findCikName</span><span class="p">(</span><span class="n">curName</span><span class="p">,</span> <span class="n">oldNames</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span> <span class="c1"># delete current name if it&#39;s in the list of old names</span>
        <span class="k">del</span> <span class="n">oldNames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># def getDLMapBetween(startD, endD,</span>
<span class="c1">#                     dlMap=None, cikNameMap=None, cikOldNamesMap=None) :</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Updates the trio of maps dlMap, cikNameMap, cikOldNamesMap</span>
<span class="c1">#     to reflect the filings for dates between startD (inclusive) and</span>
<span class="c1">#     endD (exclusive). If startD is None, uses the last date already</span>
<span class="c1">#     in dlMap, or the start of the current year if dlMap is empty.</span>
<span class="c1">#     If endD is None, uses today.</span>
<span class="c1">#     Retrieves the filings info from the SEC daily index using getDailyFList.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     if dlMap is None :</span>
<span class="c1">#         dlMap = {}</span>
<span class="c1">#     if cikNameMap is None :</span>
<span class="c1">#         cikNameMap = {}</span>
<span class="c1">#     if cikOldNamesMap is None :</span>
<span class="c1">#         cikOldNamesMap = {}</span>
<span class="c1">#     if startD is None :</span>
<span class="c1">#         if len(dlMap) == 0 :</span>
<span class="c1">#             startD = toDateStr()[:4]+&#39;0101&#39; # start of current year</span>
<span class="c1">#         else :</span>
<span class="c1">#             startD = max(dlMap.keys())</span>
<span class="c1">#     for d in reversed(dateStrsBetween(startD,endD)) :</span>
<span class="c1">#         if d in dlMap :</span>
<span class="c1">#             print &#39;SKIP&#39;+d,</span>
<span class="c1">#         else :</span>
<span class="c1">#             print d,</span>
<span class="c1">#             dlMap[d] = []</span>
<span class="c1">#             l = getDailyFList(d)</span>
<span class="c1">#             print &#39;*&#39;,</span>
<span class="c1">#             for cik, cikName, formType, fileDate, accNo in l :</span>
<span class="c1">#                 dlMap[d].append((cik,formType,accNo,</span>
<span class="c1">#                                  &#39;*&#39; if fileDate==d else fileDate, &#39;*&#39;))</span>
<span class="c1">#                 updateCikNameMapsFromEntry(d,cik,cikName,</span>
<span class="c1">#                                            cikNameMap,cikOldNamesMap)</span>
<span class="c1">#     return dlMap,cikNameMap,cikOldNamesMap</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

